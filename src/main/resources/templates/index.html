<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AutoU - Classificador de E-mails</title>
</head>
<body>

<h1>Classificador de E-mails (IA)</h1>

<p>Cole o texto do e-mail ou envie um arquivo .txt/.pdf</p>

<h2>Analisar texto</h2>
<form method="post" action="/analyze-text">
    <textarea name="text" rows="10" cols="80" placeholder="Cole aqui o texto do e-mail..."></textarea>
    <br />
    <button type="submit">Analisar texto</button>
</form>

<h2>Analisar arquivo</h2>
<form method="post" action="/analyze-file" enctype="multipart/form-data">
    <input type="file" name="file" accept=".txt,.pdf" />
    <button type="submit">Enviar e analisar</button>
</form>

<hr />

<div th:if="${errorMessage != null}">
    <p><strong>Erro:</strong> <span th:text="${errorMessage}"></span></p>
</div>

<h2>Resultado</h2>

<div th:if="${result != null}">
    <p><strong>Categoria:</strong> <span th:text="${result.category}"></span></p>
    <p><strong>Confianca:</strong> <span th:text="|${T(java.lang.Math).round(result.confidence * 100)}%|"></span></p>
    <p><strong>Motivo:</strong> <span th:text="${result.reason}"></span></p>
    <p><strong>Resposta sugerida:</strong></p>
    <pre id="suggestedReply" th:text="${result.suggestedReply}"></pre>
    <button type="button" id="copyReplyButton">Copiar resposta</button>
</div>

<div th:if="${result == null}">
    <p>(aqui vamos mostrar categoria, confianca, motivo e resposta sugerida)</p>
</div>

<script>
    const copyButton = document.getElementById("copyReplyButton");
    if (copyButton) {
        copyButton.addEventListener("click", async () => {
            const text = document.getElementById("suggestedReply")?.innerText ?? "";
            if (!text) return;
            try {
                await navigator.clipboard.writeText(text);
                copyButton.textContent = "Copiado!";
                setTimeout(() => copyButton.textContent = "Copiar resposta", 1500);
            } catch (e) {
                copyButton.textContent = "Falha ao copiar";
            }
        });
    }
</script>
</body>
</html>
